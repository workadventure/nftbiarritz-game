var a=Object.defineProperty;var c=(i,s,e)=>s in i?a(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var t=(i,s,e)=>(c(i,typeof s!="symbol"?s+"":s,e),e);class u{constructor(){t(this,"_rootLink");t(this,"uiWebSite");t(this,"subscriptions");const s="https://workadventure.github.io/nftbiarritz-game/";this._rootLink=s,this.subscriptions=new Map}async openDiscussionWebsite(s,e=null){var l;const n={url:`${this.rootLink}/views/${s}/discussion.html`,visible:!0,position:{vertical:"bottom",horizontal:"middle"},allowApi:!0,size:{height:"120px",width:"100%"},margin:{bottom:"80px",left:"10px",right:"10px"}};this.uiWebSite=await WA.ui.website.open(n),this.subscriptions.has(`close-${s}`)&&((l=this.subscriptions.get(`close-${s}`))==null||l.unsubscribe()),this.subscriptions.set(`close-${s}`,WA.event.on(`close-${s}`).subscribe(()=>{this.uiWebSite&&this.uiWebSite.close(),e&&e(this.uiWebSite),this.uiWebSite=void 0}))}closeDiscussionWebsite(s){var e;this.subscriptions.has(`close-${s}`)&&((e=this.subscriptions.get(`close-${s}`))==null||e.unsubscribe()),this.uiWebSite&&this.uiWebSite.close(),this.uiWebSite=void 0}openModalByView(s,e,n){WA.ui.modal.openModal({title:s,src:`${this.rootLink}/views/${e}/modal.html`,allowApi:!0,allow:"fullscreen;camera;microphone",position:"center"},n)}openModalByUrl(s,e,n){WA.ui.modal.openModal({title:s,src:e,allowApi:!0,allow:"fullscreen;camera;microphone",position:"center"},n)}get rootLink(){return this._rootLink}}const o=new u;console.info("Shaka contest script loaded...");WA.onInit().then(()=>{WA.controls.disableRoomList(),WA.controls.restoreRightClick(),WA.controls.disablePlayerProximityMeeting(),WA.controls.disableMapEditor(),WA.controls.disableMicrophone(),WA.controls.disableWebcam(),new p,new m,new d,new W,new h,new b,WA.ui.website.open({url:`${o.rootLink}/views/inventory/inventory.html`,visible:!0,position:{vertical:"bottom",horizontal:"right"},allowApi:!0,size:{height:"240px",width:"100px"},margin:{bottom:"200px",right:"0px"}}),console.info("Shaka contest script initialized...")});class r{constructor(s){t(this,"subscriptions");this.key=s,this.init(),this.subscriptions=[]}init(){this.subscriptions||(this.subscriptions=[]),this.subscriptions.push(WA.room.area.onEnter(this.key).subscribe(()=>this.onEnter())),this.subscriptions.push(WA.room.area.onLeave(this.key).subscribe(()=>this.onLeave()))}resolve(){WA.player.state.saveVariable(this.key,!0)}onEnter(){WA.controls.disablePlayerControls(),o.openDiscussionWebsite(this.key,()=>{this.resolve(),this.onLeave()})}onLeave(){o.closeDiscussionWebsite(this.key),WA.controls.restorePlayerControls(),this.subscriptions.forEach(s=>s.unsubscribe())}}class p extends r{constructor(){super("start")}init(){WA.controls.disablePlayerControls(),this.onEnter()}resolve(){WA.controls.restorePlayerControls()}}class h extends r{constructor(){super("info1")}resolve(){}}class b extends r{constructor(){super("info2")}resolve(){}}class m extends r{constructor(){super("treasureEnigma")}resolve(){super.resolve(),o.openModalByView("Biarritz Map","treasureEnigma")}}class d extends r{constructor(){super("surfEnigma")}}class W extends r{constructor(){super("waveEnigma");t(this,"timeToOpenForm",100)}onEnter(){if(WA.player.state.surfEnigma==null||WA.player.state.surfEnigma==!1){o.openDiscussionWebsite("noBoard");return}super.onEnter()}resolve(){super.resolve(),o.openModalByView("Biarritz Wave","waveEnigma",()=>{this.openForm()}),WA.event.on("waveEnigma:closeModal").subscribe(()=>{setTimeout(()=>{this.openForm()},this.timeToOpenForm),WA.ui.modal.closeModal()})}openForm(){setTimeout(()=>{o.openModalByUrl("SHAKA Contest form","https://docs.google.com/forms/d/e/1FAIpQLSeM4XTvLK-wLIocl8wcLoCcGu_mth-1qWfKwKZfewrrUGyIDg/viewform?embedded=true")},this.timeToOpenForm)}}
